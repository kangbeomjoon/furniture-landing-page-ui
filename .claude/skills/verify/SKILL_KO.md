# 검증 (Verification) - 한글 참고 문서

> **참고**: 이 파일은 사람이 읽기 위한 한글 참고용입니다. AI는 `SKILL.md` 원본을 사용합니다.

---

커밋 전 모든 검증 단계를 실행합니다. 프로젝트 설정을 자동으로 감지하고 적절한 도구를 실행합니다.

인자: `$ARGUMENTS` - 선택적 테스트 패턴 또는 파일 경로 (예: `"src/utils"` 또는 `"--coverage"`)

## Step 0: 프로젝트 환경 감지

검사를 실행하기 전에, 프로젝트 루트의 파일을 읽어 프로젝트 설정을 감지합니다. **사용자에게 묻지 않고 자동으로 감지하여 진행합니다.**

### 패키지 매니저 감지 (순서대로 확인)

| 잠금 파일 | 패키지 매니저 | 실행 명령어 |
|-----------|-------------|------------|
| `bun.lockb` 또는 `bun.lock` | bun | `bun run` |
| `pnpm-lock.yaml` | pnpm | `pnpm run` |
| `yarn.lock` | yarn | `yarn` |
| `package-lock.json` | npm | `npm run` |
| _(없음)_ | npm (기본값) | `npx` |

감지된 실행 명령어를 `$RUN`으로 저장하여 이후 모든 단계에서 사용합니다.

### 도구 감지 (`package.json`의 devDependencies/dependencies 및 설정 파일 확인)

사용 가능한 도구를 감지합니다. 도구를 찾을 수 없으면 **해당 단계를 조용히 건너뜁니다** — 실패하거나 경고하지 않습니다.

**포매터:**
1. package.json에서 `prettier` 확인 → `$RUN prettier --check .` 사용
2. 없으면 `@biomejs/biome` 확인 → `$RUN biome check .` 사용
3. 없으면 `dprint` 확인 → `$RUN dprint check` 사용
4. 없으면 package.json scripts에서 `format` 또는 `prettier` 키 확인 → `$RUN format` 사용
5. 없으면 포매팅 단계 건너뛰기

**린터:**
1. package.json scripts에서 `lint` 키 확인 → `$RUN lint` 사용 (최우선 — 프로젝트 설정 존중)
2. 없으면 `eslint` 확인 → `$RUN eslint .` 사용
3. 없으면 `@biomejs/biome` 확인 → `$RUN biome lint .` 사용
4. 없으면 `oxlint` 확인 → `$RUN oxlint` 사용
5. 없으면 린트 단계 건너뛰기

**타입 검사기:**
1. 프로젝트 루트에서 `tsconfig.json` 확인 → `$RUN tsc --noEmit` 사용
2. 없으면 `.flowconfig` 확인 → `$RUN flow` 사용
3. 없으면 package.json scripts에서 `typecheck` 또는 `type-check` 키 확인 → `$RUN typecheck` 사용
4. 없으면 타입 검사 단계 건너뛰기

**테스트 러너:**
1. package.json scripts에서 `test` 키 확인 → `$RUN test $ARGUMENTS` 사용
2. 없으면 `vitest` 확인 → `$RUN vitest run $ARGUMENTS` 사용
3. 없으면 `jest` 확인 → `$RUN jest $ARGUMENTS` 사용
4. 없으면 `mocha` 확인 → `$RUN mocha $ARGUMENTS` 사용
5. 없으면 `playwright` 확인 → `$RUN playwright test $ARGUMENTS` 사용
6. 없으면 테스트 단계 건너뛰기

**빌드 검사 (선택이지만 권장):**
1. package.json scripts에서 `build` 키 확인 → `$RUN build` 사용
2. 없으면 빌드 단계 건너뛰기

---

## Step 1: 순차 검사 (빠름 — 순서대로 실행, 첫 실패 시 중단)

간단한 문제를 잡는 빠른 검사입니다. **순서대로** 실행하고, 실패 시 **즉시 중단**합니다.

### 1-1. 포맷 검사

감지된 포매터 명령어를 실행합니다.
- **성공** 시: 다음 단계로 진행
- **실패** 시: 포맷이 필요한 파일을 보고하고 수정 명령어를 제안:
  - prettier: `$RUN prettier --write .`
  - biome: `$RUN biome check --write .`
  - dprint: `$RUN dprint fmt`

### 1-2. 린트 검사

감지된 린터 명령어를 실행합니다.
- **성공** 시: 다음 단계로 진행
- **실패** 시: 파일 위치와 함께 린트 오류를 보고하고 제안:
  - 자동 수정 가능한 경우: `$RUN lint --fix` 또는 `$RUN eslint --fix .`
  - 불가능한 경우: 각 오류에 대한 설명과 수정 가이드 표시

---

## Step 2: 병렬 검사 (느림 — 서브에이전트로 동시 실행)

시간이 더 걸리는 검사입니다. **서브에이전트를 사용하여 병렬로** 실행하고 모든 결과를 수집합니다. 실패 시 즉시 중단합니다.

### 2-1. 타입 검사 (서브에이전트)

감지된 타입 검사기 명령어를 실행합니다.
- **실패** 시: 파일 위치와 수정 제안과 함께 타입 오류를 보고

### 2-2. 테스트 (서브에이전트)

감지된 테스트 러너 명령어를 실행합니다.
- **실패** 시: 실패한 테스트의 이름, 예상값 vs 실제값, 수정 제안을 보고

### 2-3. 빌드 검사 (서브에이전트, 가능한 경우)

감지된 빌드 명령어를 실행합니다.
- **실패** 시: 파일 위치와 수정 제안과 함께 빌드 오류를 보고

---

## Step 3: 결과 요약

### 성공 시 (모든 단계 통과)

```
✅ 검증 완료 — 모든 검사 통과!

  ✔ 포맷     — 코드 스타일 OK
  ✔ 린트     — 이슈 없음
  ✔ 타입     — 타입 오류 없음
  ✔ 테스트   — X개 테스트 통과
  ✔ 빌드     — 빌드 성공

커밋 준비 완료.
```

### 실패 시 (하나라도 실패)

```
❌ 검증 실패

  ✔ 포맷     — 통과
  ✖ 린트     — 2개 파일에서 3개 오류      ← 이것부터 수정하세요
  ⊘ 타입     — 건너뜀 (린트 실패로 차단됨)
  ⊘ 테스트   — 건너뜀 (린트 실패로 차단됨)

수정 제안:
  $ [구체적인 수정 명령어]
  [무엇이 잘못되었고 어떻게 수정하는지 설명]
```

---

## 중요한 동작 규칙

1. **빠른 실패**: 순차 단계는 첫 실패 시 중단합니다. 순차 검사가 실패하면 병렬 검사로 넘어가지 않습니다.
2. **우아한 건너뛰기**: 도구가 감지되지 않으면 오류 없이 해당 단계를 건너뜁니다. 모든 프로젝트가 모든 도구를 사용하지는 않습니다.
3. **프로젝트 설정 존중**: 직접 도구 호출보다 항상 `package.json` scripts를 우선합니다. 프로젝트에 커스텀 플래그나 설정이 있을 수 있습니다.
4. **명확한 보고**: 실패 시 항상 파일 경로, 줄 번호, 오류 메시지, 구체적인 수정 제안을 포함합니다.
5. **자동 수정 금지**: 이슈를 보고하고 수정 명령어를 제안하되, 사용자가 명시적으로 요청하지 않는 한 자동으로 수정 명령어를 실행하지 않습니다.
